<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá¨üá≠ Ghana Inventory Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom styles -->
    <style>
        .stat-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .loading {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .tab-active {
            border-bottom: 2px solid #3B82F6;
            color: #3B82F6;
        }
        
        .risk-low { background-color: #10B981; }
        .risk-medium { background-color: #F59E0B; }
        .risk-high { background-color: #EF4444; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">üá¨üá≠ Ghana Inventory Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="exportBtn" class="flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm bg-white hover:bg-gray-50">
                        üì• Export
                    </button>
                    <button id="refreshBtn" class="flex items-center px-3 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Controls Panel -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìç Location</label>
                    <select id="locationSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Accra">Accra</option>
                        <option value="Kumasi">Kumasi</option>
                        <option value="Tamale">Tamale</option>
                        <option value="Cape Coast">Cape Coast</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Target Month</label>
                    <select id="monthSelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12" selected>December</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üè∑Ô∏è Category</label>
                    <select id="categorySelect" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Categories</option>
                        <option value="telecommunications">Telecommunications</option>
                        <option value="staple_food">Staple Food</option>
                        <option value="protein">Protein</option>
                        <option value="education">Education</option>
                        <option value="cultural_goods">Cultural Goods</option>
                        <option value="energy_solutions">Energy Solutions</option>
                        <option value="health_products">Health Products</option>
                        <option value="cooking_essentials">Cooking Essentials</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üîç Search Products</label>
                    <input type="text" id="searchInput" placeholder="Search products..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Population</p>
                        <p id="populationStat" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                    <div class="p-3 rounded-full bg-blue-100">
                        <span class="text-2xl">üë•</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Avg Score</p>
                        <p id="avgScoreStat" class="text-2xl font-bold text-gray-900">-</p>
                        <p class="text-sm text-green-600">+0.3</p>
                    </div>
                    <div class="p-3 rounded-full bg-green-100">
                        <span class="text-2xl">üìà</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Monthly Profit</p>
                        <p id="profitStat" class="text-2xl font-bold text-gray-900">-</p>
                        <p class="text-sm text-green-600">+12%</p>
                    </div>
                    <div class="p-3 rounded-full bg-emerald-100">
                        <span class="text-2xl">üí∞</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Products</p>
                        <p id="productCountStat" class="text-2xl font-bold text-gray-900">-</p>
                    </div>
                    <div class="p-3 rounded-full bg-orange-100">
                        <span class="text-2xl">üì¶</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex">
                    <button class="tab-btn tab-active py-2 px-4 border-b-2 font-medium text-sm" data-tab="overview">
                        üìä Overview
                    </button>
                    <button class="tab-btn py-2 px-4 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="recommendations">
                        üìã Recommendations
                    </button>
                    <button class="tab-btn py-2 px-4 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="analytics">
                        üìà Analytics
                    </button>
                    <button class="tab-btn py-2 px-4 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="comparison">
                        üîÑ Comparison
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tabContent">
            
            <!-- Overview Tab -->
            <div id="overview" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Regional Overview -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            üèòÔ∏è Regional Overview - <span id="regionTitle">-</span>
                        </h3>
                        <div id="regionInfo" class="space-y-4">
                            <div class="loading"></div>
                        </div>
                    </div>

                    <!-- Risk Distribution -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">‚ö†Ô∏è Risk Distribution</h3>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Tab -->
            <div id="recommendations" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">
                            üì¶ Product Recommendations for <span id="recLocationTitle">-</span>
                        </h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monthly Profit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Margin</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Risk</th>
                                </tr>
                            </thead>
                            <tbody id="recommendationsTable" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center">
                                        <div class="loading"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Category Performance -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üìä Category Performance</h3>
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>

                    <!-- Profit by Category -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üí∞ Profit by Category</h3>
                        <div class="chart-container">
                            <canvas id="profitChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Tab -->
            <div id="comparison" class="tab-content hidden">
                <div class="space-y-8">
                    <!-- Location Comparison -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üèòÔ∏è Location Comparison</h3>
                        <div class="chart-container">
                            <canvas id="locationChart"></canvas>
                        </div>
                    </div>

                    <!-- Infrastructure Comparison -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üèóÔ∏è Infrastructure Comparison</h3>
                        <div class="chart-container">
                            <canvas id="infrastructureChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-50">
            <div class="flex items-center justify-center h-full">
                <div class="bg-white rounded-lg p-8 text-center">
                    <div class="loading mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading data...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentData = {};
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            loadInitialData();
        });

        function initializeEventListeners() {
            // Control changes
            document.getElementById('locationSelect').addEventListener('change', loadData);
            document.getElementById('monthSelect').addEventListener('change', loadData);
            document.getElementById('categorySelect').addEventListener('change', loadData);
            document.getElementById('searchInput').addEventListener('input', debounce(loadData, 300));

            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => switchTab(e.target.dataset.tab));
            });

            // Action buttons
            document.getElementById('refreshBtn').addEventListener('click', () => {
                loadData(true);
            });

            document.getElementById('exportBtn').addEventListener('click', exportData);
        }

        function loadInitialData() {
            loadRegionData();
            loadData();
        }

        async function loadRegionData() {
            try {
                const response = await fetch('/api/regions');
                const regions = await response.json();
                
                const locationSelect = document.getElementById('locationSelect');
                locationSelect.innerHTML = '';
                
                Object.keys(regions).forEach(regionName => {
                    const option = document.createElement('option');
                    option.value = regionName;
                    option.textContent = regionName;
                    locationSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading regions:', error);
                showError('Failed to load regions');
            }
        }

        async function loadData(forceRefresh = false) {
            const location = document.getElementById('locationSelect').value;
            const month = document.getElementById('monthSelect').value;
            const category = document.getElementById('categorySelect').value;
            const search = document.getElementById('searchInput').value;

            showLoading(true);

            try {
                // Load recommendations
                const recParams = new URLSearchParams({
                    location: location,
                    month: month,
                    limit: 20
                });
                
                if (category !== 'all') {
                    recParams.append('category', category);
                }

                const [recResponse, analyticsResponse, comparisonResponse] = await Promise.all([
                    fetch(`/api/recommendations?${recParams}`),
                    fetch(`/api/analytics?location=${location}&month=${month}`),
                    fetch('/api/comparison')
                ]);

                const recommendations = await recResponse.json();
                const analytics = await analyticsResponse.json();
                const comparison = await comparisonResponse.json();

                currentData = {
                    recommendations,
                    analytics,
                    comparison,
                    location,
                    month
                };

                updateDashboard();

            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data');
            } finally {
                showLoading(false);
            }
        }

        function updateDashboard() {
            const { recommendations, analytics, comparison, location } = currentData;
            
            updateStats(recommendations, comparison[location]);
            updateRegionInfo(comparison[location]);
            updateRecommendationsTable(recommendations.recommendations);
            updateCharts();
        }

        function updateStats(recommendations, regionData) {
            const recs = recommendations.recommendations || [];
            
            // Population
            document.getElementById('populationStat').textContent = 
                regionData ? `${(regionData.population / 1000000).toFixed(1)}M` : '-';
            
            // Average Score
            const avgScore = recs.length > 0 ? 
                (recs.reduce((sum, rec) => sum + rec.business_score, 0) / recs.length).toFixed(1) : '0';
            document.getElementById('avgScoreStat').textContent = avgScore;
            
            // Total Profit
            const totalProfit = recs.reduce((sum, rec) => sum + rec.monthly_profit, 0);
            document.getElementById('profitStat').textContent = `¬¢${totalProfit.toLocaleString()}`;
            
            // Product Count
            document.getElementById('productCountStat').textContent = recs.length;
        }

        function updateRegionInfo(regionData) {
            if (!regionData) return;
            
            document.getElementById('regionTitle').textContent = regionData.location;
            document.getElementById('recLocationTitle').textContent = regionData.location;
            
            const regionInfoDiv = document.getElementById('regionInfo');
            regionInfoDiv.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Income Level:</span>
                    <span class="font-medium capitalize">${regionData.income_level}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Population:</span>
                    <span class="font-medium">${regionData.population.toLocaleString()}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Infrastructure Score:</span>
                    <span class="font-medium">${regionData.infrastructure_score}/10</span>
                </div>
                <div class="mt-4">
                    <h4 class="font-medium text-gray-900 mb-3">üèóÔ∏è Infrastructure Details</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Overall Score</span>
                            <span>${regionData.infrastructure_score}/10</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${regionData.infrastructure_score * 10}%"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateRecommendationsTable(recommendations) {
            const tbody = document.getElementById('recommendationsTable');
            
            if (!recommendations || recommendations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No recommendations found</td></tr>';
                return;
            }

            tbody.innerHTML = recommendations.map(rec => {
                const scoreColor = rec.business_score >= 8 ? 'text-green-600' : 
                                 rec.business_score >= 6 ? 'text-yellow-600' : 'text-red-600';
                
                const riskLevel = rec.business_score >= 8 ? 'Low' : 
                                rec.business_score >= 6 ? 'Medium' : 'High';
                
                const riskColor = riskLevel === 'Low' ? 'text-green-600 bg-green-100' :
                                riskLevel === 'Medium' ? 'text-yellow-600 bg-yellow-100' :
                                'text-red-600 bg-red-100';

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${rec.product}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">${rec.category}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium ${scoreColor}">${rec.business_score.toFixed(1)}/10</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">¬¢${rec.monthly_profit.toLocaleString()}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${rec.profit_margin}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${riskColor}">
                                ${riskLevel}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateCharts() {
            const { analytics, comparison } = currentData;
            
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });

            // Risk Distribution Chart
            createRiskChart(analytics.risk_distribution);
            
            // Category Performance Chart
            createCategoryChart(analytics.category_performance);
            
            // Profit Chart
            createProfitChart(analytics.category_performance);
            
            // Location Comparison Chart
            createLocationChart(comparison);
            
            // Infrastructure Chart
            createInfrastructureChart(comparison);
        }

        function createRiskChart(riskData) {
            const ctx = document.getElementById('riskChart').getContext('2d');
            charts.risk = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                    datasets: [{
                        data: [riskData.Low || 0, riskData.Medium || 0, riskData.High || 0],
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createCategoryChart(categoryData) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            charts.category = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categoryData.map(cat => cat.category.replace('_', ' ')),
                    datasets: [{
                        label: 'Average Score',
                        data: categoryData.map(cat => cat.avg_score),
                        backgroundColor: '#3B82F6',
                        borderColor: '#1D4ED8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        function createProfitChart(categoryData) {
            const ctx = document.getElementById('profitChart').getContext('2d');
            charts.profit = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categoryData.map(cat => cat.category.replace('_', ' ')),
                    datasets: [{
                        label: 'Total Profit (¬¢)',
                        data: categoryData.map(cat => cat.total_profit),
                        backgroundColor: '#10B981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createLocationChart(comparisonData) {
            const ctx = document.getElementById('locationChart').getContext('2d');
            const locations = Object.keys(comparisonData);
            
            charts.location = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: locations,
                    datasets: [
                        {
                            label: 'Average Score',
                            data: locations.map(loc => comparisonData[loc].avg_score),
                            backgroundColor: '#3B82F6',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Total Profit (¬¢)',
                            data: locations.map(loc => comparisonData[loc].total_profit),
                            backgroundColor: '#10B981',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            max: 10
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function createInfrastructureChart(comparisonData) {
            const ctx = document.getElementById('infrastructureChart').getContext('2d');
            const locations = Object.keys(comparisonData);
            
            charts.infrastructure = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: locations,
                    datasets: [{
                        label: 'Infrastructure Score',
                        data: locations.map(loc => comparisonData[loc].infrastructure_score),
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3B82F6',
                        borderWidth: 2,
                        pointBackgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        function showError(message) {
            alert(`Error: ${message}`);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        async function exportData() {
            try {
                const location = document.getElementById('locationSelect').value;
                const month = document.getElementById('monthSelect').value;
                
                const response = await fetch(`/api/export?location=${location}&month=${month}&format=json`);
                const data = await response.json();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ghana-inventory-${location}-${month}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
            } catch (error) {
                console.error('Export error:', error);
                showError('Failed to export data');
            }
        }
    </script>
</body>
</html>